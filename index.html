
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Turbojet + Afterburner Cycle Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
    }

    header {
      padding: 1rem 2rem;
      background: #020617;
      border-bottom: 1px solid #1f2937;
    }

    header h1 {
      margin: 0;
      font-size: 1.35rem;
    }

    main {
      display: flex;
      flex-wrap: wrap;
      padding: 1rem 2rem 2rem;
      gap: 1.5rem;
    }

    .card {
      background: #020617;
      border: 1px solid #1f2937;
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      box-shadow: 0 10px 25px rgba(15,23,42,0.9);
    }

    .inputs {
      flex: 1 1 320px;
      max-width: 380px;
    }

    .plots {
      flex: 3 1 760px;
      min-width: 0;
    }

    .plot-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      align-items: start;
      margin-top: 1rem;
    }

    @media (max-width: 900px) {
      .plot-grid {
        grid-template-columns: 1fr;
      }
    }

    canvas {
      width: 100% !important;
      height: 400px !important;
      background: #020617;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      padding: 0.5rem;
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.6rem 0.8rem;
      font-size: 0.85rem;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    label {
      color: #9ca3af;
    }

    input {
      background: #020617;
      border-radius: 0.5rem;
      border: 1px solid #4b5563;
      color: #e5e7eb;
      padding: 0.3rem 0.4rem;
      font-size: 0.85rem;
    }

    input:focus {
      outline: 2px solid #38bdf8;
      border-color: #38bdf8;
    }

    button {
      background: #38bdf8;
      border: none;
      border-radius: 999px;
      padding: 0.4rem 0.85rem;
      font-size: 0.85rem;
      cursor: pointer;
      color: #020617;
      font-weight: 600;
    }

    .button-row {
      margin-top: 1rem;
      display: flex;
      gap: 0.6rem;
    }

    button.secondary {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid #4b5563;
    }

    button:hover {
      filter: brightness(1.1);
    }

    .note {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-top: 0.4rem;
    }
  </style>
</head>

<body>
  <header>
    <h1>Turbojet / Afterburner Performance Explorer</h1>
  </header>

  <main>
    <!-- INPUT PANEL -->
    <section class="card inputs">
      <h2>Inputs</h2>
      <p class="note">Modify values and click <b>Run Analysis</b>.</p>

      <div class="input-grid">
        <div class="input-group">
          <label>P<sub>amb</sub> [Pa]</label>
          <input id="Pamb" value="12112">
        </div>
        <div class="input-group">
          <label>T<sub>amb</sub> [K]</label>
          <input id="Tamb" value="216.65">
        </div>
        <div class="input-group">
          <label>Mach</label>
          <input id="Mach" value="1.8">
        </div>
        <div class="input-group">
          <label>R [J/(kg·K)]</label>
          <input id="R" value="287">
        </div>

        <div class="input-group">
          <label>T<sub>04,max</sub></label>
          <input id="To4_max" value="1500">
        </div>
        <div class="input-group">
          <label>T<sub>06,max,AB</sub></label>
          <input id="To6_ab_max" value="2000">
        </div>

        <div class="input-group">
          <label>LHV (h<sub>c</sub>)</label>
          <input id="hc" value="43124000">
        </div>
        <div class="input-group">
          <label>f<sub>st</sub></label>
          <input id="f_st" value="0.06">
        </div>

        <div class="input-group"><label>η<sub>d</sub></label><input id="eta_d" value="0.9"></div>
        <div class="input-group"><label>η<sub>c</sub></label><input id="eta_c" value="0.9"></div>
        <div class="input-group"><label>η<sub>b</sub></label><input id="eta_b" value="0.98"></div>
        <div class="input-group"><label>η<sub>t</sub></label><input id="eta_t" value="0.92"></div>
        <div class="input-group"><label>η<sub>n</sub></label><input id="eta_n" value="0.98"></div>
        <div class="input-group"><label>η<sub>ab</sub></label><input id="eta_ab" value="0.95"></div>

        <div class="input-group"><label>r<sub>b</sub></label><input id="Rb" value="0.97"></div>
        <div class="input-group"><label>r<sub>ab</sub></label><input id="Rab" value="0.97"></div>

        <div class="input-group"><label>γ (1–3)</label><input id="gam_1_3" value="1.4"></div>
        <div class="input-group"><label>γ (3–7)</label><input id="gam_3_7" value="1.3"></div>

        <div class="input-group"><label>R<sub>c,min</sub></label><input id="Rc_min" value="2"></div>
        <div class="input-group"><label>R<sub>c,max</sub></label><input id="Rc_max" value="60"></div>
      </div>

      <div class="button-row">
        <button id="runBtn">Run Analysis</button>
        <button class="secondary" id="resetBtn">Reset</button>
      </div>
    </section>

    <!-- PLOTS -->
    <section class="card plots">
      <h2>Results</h2>

      <div class="plot-grid">
        <canvas id="thrustChart"></canvas>
        <canvas id="tsfcChart"></canvas>
        <canvas id="areaChart"></canvas>
        <canvas id="etaNoABChart"></canvas>
        <canvas id="etaABChart"></canvas>
      </div>
    </section>
  </main>

  <!-- SCRIPT BLOCK WITH ALL LOGIC -->
  <script>
    function Cp(g, R) { return R / (1 - 1/g); }

    function machFromTR(TR, g) {
      if (TR <= 0 || TR >= 1) return 0;
      const M2 = (2/(g-1))*(1/TR - 1);
      return M2 > 0 ? Math.sqrt(M2) : 0;
    }

    function read() {
      const v = id => parseFloat(document.getElementById(id).value);
      return {
        Pamb:v("Pamb"), Tamb:v("Tamb"), Mach:v("Mach"), R:v("R"),
        To4_max:v("To4_max"), To6_ab_max:v("To6_ab_max"),
        hc:v("hc"), f_st:v("f_st"),
        eta_d:v("eta_d"), eta_c:v("eta_c"), eta_b:v("eta_b"),
        eta_t:v("eta_t"), eta_n:v("eta_n"), eta_ab:v("eta_ab"),
        Rb:v("Rb"), Rab:v("Rab"),
        gam_1_3:v("gam_1_3"), gam_3_7:v("gam_3_7"),
        Rc_min:v("Rc_min"), Rc_max:v("Rc_max")
      };
    }

    function defaults() {
      return {
        Pamb:12112, Tamb:216.65, Mach:1.8, R:287,
        To4_max:1500, To6_ab_max:2000,
        hc:43124000, f_st:0.06,
        eta_d:0.9, eta_c:0.9, eta_b:0.98,
        eta_t:0.92, eta_n:0.98, eta_ab:0.95,
        Rb:0.97, Rab:0.97,
        gam_1_3:1.4, gam_3_7:1.3,
        Rc_min:2, Rc_max:60
      };
    }

    function resetInputs() {
      const d = defaults();
      Object.entries(d).forEach(([k,v])=>{
        const el=document.getElementById(k);
        if(el) el.value=v;
      });
    }

    function cycleNoAB(Rc,p){  
      let { Pamb,Tamb,Mach,R,To4_max,hc,f_st,eta_d,eta_c,eta_b,eta_t,eta_n,Rb,gam_1_3,gam_3_7 }=p;

      let g=gam_1_3;
      let Poa_P = Math.pow(1+0.5*(g-1)*Mach*Mach, g/(g-1));
      let Toa_T = 1+0.5*(g-1)*Mach*Mach;
      let Poa=Poa_P*Pamb, Toa=Toa_T*Tamb;
      let V = Mach*Math.sqrt(g*R*Tamb);

      let To2=Toa;
      let To2s=Tamb+eta_d*(To2-Tamb);
      let Po2=Math.pow(To2s/Tamb, g/(g-1))*Pamb;

      let To3s=Math.pow(Rc,(g-1)/g)*To2;
      let Po3=Rc*Po2;
      let To3=To2+(To3s-To2)/eta_c;
      let Cp1=Cp(g,R);
      let Wc=Cp1*(To3-To2);

      g=gam_3_7;
      let Cp2=Cp(g,R);

      let fpos=((To4_max/To3)-1)/((eta_b*hc/(Cp2*To3))-(To4_max/To3));
      let fb,To4;
      if(fpos>f_st){
        fb=f_st;
        To4=(Cp2*To3+eta_b*fb*hc)/(Cp2*(1+fb));
      } else {
        fb=fpos; To4=To4_max;
      }

      let Po4=Rb*Po3;

      let To5 = To4 - Wc/((1+fb)*Cp2);
      let To5s = To4 - eta_t*(To4-To5);
      let Po5 = Math.pow(To5s/To4, g/(g-1))*Po4;

      let Po6=Po5, P7=Pamb;
      let To6=To5, To7=To6;
      let T7s = To6/Math.pow(Po6/P7,(g-1)/g);
      let T7 = To6 - eta_n*(To6-T7s);

      let TR=T7/To7;
      let M7=machFromTR(TR,g);
      let V7=M7*Math.sqrt(g*R*T7);

      let I=(1+fb)*V7 - V;
      let TSFC=fb/I;
      let Ae_At = (M7>0) ? (1/M7)*Math.pow((2/(g+1))*(1+0.5*(g-1)*M7*M7),(g+1)/(2*(g-1))) : 0;
      let etap = (I*V)/((1+fb)*(V7*V7/2)-V*V/2);
      let etath = ((1+fb)*V7*V7 - V*V)/(2*fb*hc);
      let etao = etap*etath;

      return {I,TSFC,Ae_At,eta_p:etap,eta_th:etath,eta_o:etao};
    }

    function cycleAB(Rc,p){
      let { Pamb,Tamb,Mach,R,To4_max,To6_ab_max,hc,f_st,eta_d,eta_c,eta_b,eta_t,eta_n,eta_ab,Rb,Rab,gam_1_3,gam_3_7 }=p;

      let g=gam_1_3;
      let Poa_P = Math.pow(1+0.5*(g-1)*Mach*Mach, g/(g-1));
      let Toa_T = 1+0.5*(g-1)*Mach*Mach;
      let Poa=Poa_P*Pamb, Toa=Toa_T*Tamb;
      let V = Mach*Math.sqrt(g*R*Tamb);

      let To2=Toa;
      let To2s=Tamb+eta_d*(To2-Tamb);
      let Po2=Math.pow(To2s/Tamb, g/(g-1))*Pamb;

      let To3s=Math.pow(Rc,(g-1)/g)*To2;
      let Po3=Rc*Po2;
      let To3=To2+(To3s-To2)/eta_c;
      let Cp1=Cp(g,R);
      let Wc=Cp1*(To3-To2);

      g=gam_3_7;
      let Cp2=Cp(g,R);

      let fpos=((To4_max/To3)-1)/((eta_b*hc/(Cp2*To3))-(To4_max/To3));
      let fb,To4;
      if(fpos>f_st){
        fb=f_st;
        To4=(Cp2*To3+eta_b*fb*hc)/(Cp2*(1+fb));
      } else {
        fb=fpos; To4=To4_max;
      }

      let Po4=Rb*Po3;

      let To5 = To4 - Wc/((1+fb)*Cp2);
      let To5s = To4 - eta_t*(To4-To5);
      let Po5 = Math.pow(To5s/To4, g/(g-1))*Po4;

      let fab_unc = (1+fb)*(To6_ab_max-To5)/((eta_ab*hc/Cp2) - To6_ab_max);
      let fab,To6;

      if(fb+fab_unc>f_st){
        fab=f_st-fb;
        To6 = (Cp2*To5*(1+fb) + eta_ab*fab*hc)/(Cp2*(1+fb+fab));
      } else {
        fab=fab_unc; To6=To6_ab_max;
      }

      let fbTot=fb+fab;
      let Po6=Rab*Po5;

      let P7=Pamb, To7=To6;
      let T7s=To6/Math.pow(Po6/P7,(g-1)/g);
      let T7=To6-eta_n*(To6-T7s);

      let TR=T7/To7;
      let M7=machFromTR(TR,g);
      let V7=M7*Math.sqrt(g*R*T7);

      let I=(1+fbTot)*V7 - V;
      let TSFC=fbTot/I;
      let Ae_At = (M7>0) ? (1/M7)*Math.pow((2/(g+1))*(1+0.5*(g-1)*M7*M7),(g+1)/(2*(g-1))) : 0;
      let etap = (I*V)/((1+fbTot)*(V7*V7/2)-V*V/2);
      let etath = ((1+fbTot)*V7*V7 - V*V)/(2*fbTot*hc);
      let etao = etap*etath;

      return {I,TSFC,Ae_At,eta_p:etap,eta_th:etath,eta_o:etao};
    }

    function run(p){
      const Rmin = Math.round(p.Rc_min);
      const Rmax = Math.round(p.Rc_max);

      const Rc = [];
      const I=[],TSFC=[],Ae=[],ep=[],eth=[],eo=[];
      const I2=[],TSFC2=[],Ae2=[],ep2=[],eth2=[],eo2=[];

      for(let rc=Rmin; rc<=Rmax; rc++){
        Rc.push(rc);
        let a=cycleNoAB(rc,p);
        let b=cycleAB(rc,p);

        I.push(a.I);      I2.push(b.I);
        TSFC.push(a.TSFC);TSFC2.push(b.TSFC);
        Ae.push(a.Ae_At); Ae2.push(b.Ae_At);
        ep.push(a.eta_p); ep2.push(b.eta_p);
        eth.push(a.eta_th);eth2.push(b.eta_th);
        eo.push(a.eta_o); eo2.push(b.eta_o);
      }

      return {Rc,I,TSFC,Ae,ep,eth,eo,I2,TSFC2,Ae2,ep2,eth2,eo2};
    }

    let thrustChart,tsfcChart,areaChart,eta1Chart,eta2Chart;

    function makeChart(old,ctx,data){
      if(old){ old.data=data.data; old.options=data.options; old.update(); return old; }
      return new Chart(ctx,data);
    }

    function updatePlots(r){
      const commonScales = {
        x:{ticks:{color:"#9ca3af"}, title:{display:true,text:"R_c",color:"#9ca3af"}},
        y:{ticks:{color:"#9ca3af"}, title:{display:true,text:"",color:"#9ca3af"}}
      };

      thrustChart = makeChart(thrustChart,
        document.getElementById("thrustChart"),
      {
        type:"line",
        data:{
          labels:r.Rc,
          datasets:[
            {label:"I (no AB)",data:r.I,borderWidth:2},
            {label:"I (with AB)",data:r.I2,borderWidth:2}
          ]
        },
        options:{
          plugins:{legend:{labels:{color:"#e5e7eb"}},title:{display:true,text:"Specific Thrust",color:"#e5e7eb"}},
          scales:commonScales
        }
      });

      tsfcChart = makeChart(tsfcChart,
        document.getElementById("tsfcChart"),
      {
        type:"line",
        data:{
          labels:r.Rc,
          datasets:[
            {label:"TSFC (no AB)",data:r.TSFC,borderWidth:2},
            {label:"TSFC (with AB)",data:r.TSFC2,borderWidth:2}
          ]
        },
        options:{
          plugins:{legend:{labels:{color:"#e5e7eb"}},title:{display:true,text:"TSFC",color:"#e5e7eb"}},
          scales:commonScales
        }
      });

      areaChart = makeChart(areaChart,
        document.getElementById("areaChart"),
      {
        type:"line",
        data:{
          labels:r.Rc,
          datasets:[
            {label:"Ae/At (no AB)",data:r.Ae,borderWidth:2},
            {label:"Ae/At (with AB)",data:r.Ae2,borderWidth:2}
          ]
        },
        options:{
          plugins:{legend:{labels:{color:"#e5e7eb"}},title:{display:true,text:"Nozzle Area Ratio",color:"#e5e7eb"}},
          scales:commonScales
        }
      });

      eta1Chart = makeChart(eta1Chart,
        document.getElementById("etaNoABChart"),
      {
        type:"line",
        data:{
          labels:r.Rc,
          datasets:[
            {label:"η_p",data:r.ep,borderWidth:2},
            {label:"η_th",data:r.eth,borderWidth:2},
            {label:"η_o",data:r.eo,borderWidth:2}
          ]
        },
        options:{
          plugins:{legend:{labels:{color:"#e5e7eb"}},title:{display:true,text:"Efficiencies (No AB)",color:"#e5e7eb"}},
          scales:commonScales
        }
      });

      eta2Chart = makeChart(eta2Chart,
        document.getElementById("etaABChart"),
      {
        type:"line",
        data:{
          labels:r.Rc,
          datasets:[
            {label:"η_p",data:r.ep2,borderWidth:2},
            {label:"η_th",data:r.eth2,borderWidth:2},
            {label:"η_o",data:r.eo2,borderWidth:2}
          ]
        },
        options:{
          plugins:{legend:{labels:{color:"#e5e7eb"}},title:{display:true,text:"Efficiencies (With AB)",color:"#e5e7eb"}},
          scales:commonScales
        }
      });
    }

    document.getElementById("runBtn").onclick = ()=>{
      const p = read();
      updatePlots(run(p));
    };

    document.getElementById("resetBtn").onclick = ()=>{
      resetInputs();
    };

    resetInputs();
    updatePlots(run(defaults()));
  </script>
</body>
</html>
